# èµ°ä¸Šæ‰¾å·¥ä½œçš„è·¯

## **iOSå†…å­˜ç®¡ç†**

åœ¨Objective-Cä¸­æœ‰ä¸¤å¥—å†…å­˜ç®¡ç†ç­–ç•¥ï¼ŒMRC(Mannul Reference Counting)å’ŒARC(Automatic Referenct Counting)ï¼Œä½†æ˜¯ä¸¤å¥—éƒ½æ˜¯åŸºäºå¼•ç”¨è®¡æ•°æ¥è¿›è¡Œå†…å­˜ç®¡ç†çš„ã€‚
	
MRCéµå¾ªç€è°åˆ›å»ºè°é‡Šæ”¾ï¼Œä¸€èˆ¬ä¼šæœ‰å¦‚ä¸‹æƒ…å†µï¼Œåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡çš„æ–¹æ³•ï¼š`new`,`alloc`,`copy`,`mutableCopy`,æ­¤æ—¶çš„å¼•ç”¨è®¡æ•°éƒ½æ˜¯retain countéƒ½æ˜¯ä¸º1ã€‚æ­¤æ—¶å½“è¿›è¡Œäº†å¦‚ä¸‹æ“ä½œï¼Œæ–°å¯¹è±¡ä¼šè·å–åŸæ¥å¯¹è±¡çš„æ‰€æœ‰æƒï¼Œå¼•ç”¨è®¡æ•°å°±ä¼šå¢åŠ ï¼Œ`id newObj = [oldObj retain]`, æ‰€ä»¥ï¼Œé’ˆå¯¹å¦‚ä¸Šçš„æ“ä½œéƒ½éœ€è¦æ‰‹åŠ¨è°ƒç”¨`release`ã€‚å¦‚ä¸‹ï¼Œ`[newObj release]`.  
	
ARCæ˜¯è‡ªiOS5ä¹‹åæ¨å‡ºçš„æ–°çš„å†…å­˜ç®¡ç†ç­–ç•¥ï¼Œä¸€ç§è‡ªåŠ¨å¼•ç”¨è®¡æ•°æŠ€æœ¯ã€‚å…¶ç®¡ç†å†…å­˜çš„ç­–ç•¥å’ŒMRCä¸€è‡´ï¼Œä»…ä»…åªæ˜¯ç¼–è¯‘å™¨åœ¨ç‰¹å®šçš„ä½ç½®å¸®æˆ‘ä»¬åŠ ä¸Š`release`ä»£ç ã€‚
> Automatic Reference Counting (ARC) is a compiler feature that provides automatic memory management of Objective-C objects. Rather than having to think about retain and release operations, ARC allows you to concentrate on the interesting code.

æœ¬äººä¹Ÿæ˜¯ä»iOS7å¼€å§‹æ¥è§¦iOSå¼€å‘çš„ã€‚æ‰€ä»¥ä¸€ç›´ä»¥æ¥éƒ½æ˜¯ä½¿ç”¨ARCå†…å­˜ç®¡ç†è§„åˆ™ã€‚
> ARC works by adding code at compile time to ensure that objects live as long as necessary, but no longer.

ARCçš„è§£é‡Šæ˜¯åœ¨ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨ä¼šåœ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸­æ·»åŠ å¿…è¦çš„ä»£ç (`release`ä»£ç )ã€‚å³ï¼Œç°åœ¨ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨çš„è°ƒç”¨`release`

* **iOS ä¸­å¯èƒ½çš„å†…å­˜æ³„æ¼**
	* å¾ªç¯å¼•ç”¨  
		åªè¦æ˜¯ä½¿ç”¨äº†çš„æ˜¯å¼•ç”¨è®¡æ•°ç­–ç•¥è¿›è¡Œå†…å­˜ç®¡ç†çš„ï¼Œå°±ä¼šæœ‰å‡ºç°å¾ªç¯å¼•ç”¨çš„å¯èƒ½æ€§ï¼Œå¯¼è‡´å†…å­˜æ— æ³•é‡Šæ”¾æ‰è€Œå†…å­˜æ³„æ¼ã€‚
		1. å¯¹è±¡é—´çš„å¾ªç¯å¼•ç”¨	ï¼Œä½¿ç”¨å¼±å¼•ç”¨æ¥ç ´è§£ã€‚å¦‚ä¸‹ï¼Œåˆ†åˆ«æœ‰objAï¼ŒobjBï¼ŒobjCï¼Œä¸‰ä¸ªå¯¹è±¡ï¼Œå±æ€§é—´ç›¸äº’å¼•ç”¨ï¼Œé€ æˆäº†å¾ªç¯å¼•ç”¨ã€‚æ­¤æ—¶å¯ä»¥è®¾ç½®å¯¹è±¡objCæŒ‡å‘å¯¹è±¡objAçš„å±æ€§ä¸ºå¼±å¼•ç”¨ç±»å‹ã€‚
		
				objA.property = objB;
				objB.property = objC;
				objC.property = objA;
		
			
		2. å¯¹è±¡å’ŒBlockä¹‹é—´çš„å¾ªç¯å¼•ç”¨
				
				self.someBlock = ^{ self.property = xxx; };
			å¦‚ä¸Šå‡ºç°äº†å¾ªç¯å¼•ç”¨ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨å¯ä»¥æ£€æµ‹å‡ºï¼Œç›´æ¥ä¼šæŠ¥é”™ã€‚ä½†æ˜¯å½“æœ‰å…¶ä»–å¯¹è±¡ä»‹å…¥çš„æ—¶å€™æ—¶å€™ï¼Œç¼–è¯‘å™¨å°±ä¸èƒ½åœ¨ç¼–è¯‘æœŸå‘ç°æ˜¯å¦å‡ºç°äº†å¾ªç¯å¼•ç”¨ã€‚  
				
				someObj.someBlock = ^{ self.property = xxx;};
				self.someObj = someObj;
			
			* **è§£å†³æ–¹æ¡ˆ**
			
			ä½¿ç”¨`__weak`ä¿®é¥°ï¼Œå¼±åŒ–blockä¸­å¯¹è±¡å¼•ç”¨ã€‚å¦‚ä¸‹
			
				__weak SomeObjectClass *weakSelf = self;
				someObj.someBlock = ^{
					SomeObjectClass *strongSelf = weakSelf;
					if (strongSelf == nil) {
						// handle 
					}
					[strongSelf sendMsg];
				};
		
		3. 	NSTimer 
			
			åœ¨OCä¸­æœ‰å¾ˆå¤šçš„`Action/Target`çš„æ¨¡å¼ï¼Œå¤§å¤šæ•°çš„æƒ…å†µä¸‹éƒ½æ˜¯å¼±å¼•ç”¨äº†`target`ï¼Œä½†æ˜¯åœ¨NSTimerä¸­å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œ`timer`å¯¹è±¡å¼ºå¼•ç”¨äº†`target`
			
				+ (NSTimer *)timerWithTimeInterval:(NSTimeInterval)seconds
                        					target:(id)target
					                      selector:(SEL)aSelector
                      					  userInfo:(id)userInfo
                       					   repeats:(BOOL)repeats
			> è§£é‡Štarget : The object to which to send the message specified by aSelector when the timer fires. The timer maintains a strong reference to this object until it (the timer) is invalidated.

## **UITableViewçš„ä¼˜åŒ–**

`UITableView`å¯¹äºiOSå¼€å‘è€Œè¨€ï¼Œä¸èƒ½å†ç†Ÿæ‚‰äº†ï¼Œè¿™ä¹Ÿæ˜¯iOSå’ŒAndroidæµç•…æ€§æœ€ä¸ºç›´è§‚çš„åœ°æ–¹ã€‚æ‰€ä»¥åšå¥½`UITableView`çš„ä¼˜åŒ–ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ã€‚ï¼ˆğŸ˜„ï¼Œå…¶å®åªè¦åœ¨å¼€å‘ä¸­ä¿æŒä¸€ä¸ªå¥½ä¹ æƒ¯å°±è¡Œï¼‰

**æ¦‚å¿µ**  
`UITableView`æœ€ä¸ºå…³é”®çš„å°±æ˜¯å‡ ä¸ªä»£ç†æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯è¿”å›cellçš„`- tableView:cellForRowAtIndexPath:`ï¼Œä¸€ä¸ªæ˜¯è¿”å›é«˜åº¦çš„`- tableView:heightForRowAtIndexPath:`ã€‚ç”±äº`UITableView`æ˜¯ç»§æ‰¿äº`UIScrollView`ï¼Œæ‰€ä»¥å¿…é¡»ä¼˜å…ˆè®¡ç®—å‡º`contentSize`ï¼Œæ‰€æœ‰ä¼šå…ˆè°ƒç”¨`- tableView:heightForRowAtIndexPath:`è¿›è¡Œæ•´ä½“å¸ƒå±€ï¼Œä¹‹åè°ƒç”¨è¿”å›cellçš„æ–¹æ³•ï¼Œè¿›è¡Œcellå†…éƒ¨çš„å¸ƒå±€ã€‚

æ‰€ä»¥ï¼š 

1. è¿”å›é«˜åº¦çš„æ–¹æ³•`- tableView:heightForRowAtIndexPath:`è°ƒç”¨æ¬¡æ•°æœ€å¤šã€‚
2. è¿”å›cellçš„æ–¹æ³•`- tableView:cellForRowAtIndexPath:`æœ€è€—æ—¶ã€‚

ä¼˜åŒ–ï¼š

1. åœ¨è·å–åˆ°æ•°æ®åï¼ŒæŠŠcellçš„é«˜åº¦æå‰è®¡ç®—å¥½ï¼Œå­˜å‚¨åœ¨model(æˆ–è€…å…¶ä»–åœ°æ–¹)ä¸­ï¼Œåœ¨`- tableView:heightForRowAtIndexPath:`å›è°ƒä¸­ç›´æ¥ä½¿ç”¨ã€‚
2. å¯¹cellä¸­ä¸è¦æ·»åŠ å¤ªå¤šçš„subViewã€‚æ›´å¤šçš„subViewéœ€è¦æ›´å¤šçš„å¸ƒå±€ç­‰å…¶ä»–æ–¹é¢çš„è®¡ç®—ã€‚
3. å¯¹äºè¦æ±‚å¾ˆé«˜çš„tableViewï¼Œcellä¸è¦ä½¿ç”¨xibï¼Œæ¯•ç«Ÿéœ€è¦å¯¹xibè¿›è¡Œè½¬åŒ–ã€‚
4. å¯ä»¥ç”¨å»ç»˜ç”»ä¸€ä¸ªcellï¼Œä¸ç”¨ç³»ç»Ÿè‡ªå¸¦çš„view.(å¯¹tableViewæ»‘åŠ¨è¦æ±‚æ›´é«˜)
5. ä½¿ç”¨åŠ¨æ€æŒ‰éœ€åŠ è½½ï¼Œå³åªæœ‰å½“tableViewå¿«é€Ÿæ»‘åŠ¨ç»“æŸåå†åŠ è½½å¯è§†èŒƒå›´å†…çš„cell

tableViewå…¶ä»–ä¸€äº›å¸¸ç”¨çš„æ­£ç¡®çš„ç”¨æ³•ï¼š

1. æ­£ç¡®ä½¿ç”¨é‡ç”¨æœºåˆ¶
2. cellä¸­å°½é‡ä¸è¦ä½¿ç”¨alphaå€¼ä¸ä¸º1çš„viewï¼Œä¸ç„¶ä¼šé€ æˆå›¾å±‚æ··åˆ
3. cellä¸­ä¸è¦å¤§é‡è®¾ç½®åœ†è§’ï¼Œé¿å…å‡ºç°ç¦»å±æ¸²æŸ“ã€‚éœ€è¦åœ†è§’å¯ä»¥è‡ªå·±ç»˜åˆ¶ã€‚
4. cellä¸­å›¾å±‚å°½é‡ä¸è®¾ç½®é˜´å½±ï¼Œå¿…è¦æ—¶å¯ä»¥ä½¿ç”¨æ …æ ¼åŒ–æŠ€æœ¯ï¼Œå’Œè‡ªè¡Œç»˜åˆ¶é˜´å½±è·¯å¾„ï¼Œé˜²æ­¢ç”±äºé˜´å½±ç…§æˆçš„ç¦»å±æ¸²æŸ“ã€‚
5. åœ¨cellä¸­æœ€å¥½ä¸è¦åŠ¨æ€çš„åˆ›å»ºsubviewï¼Œæœ€å¥½åœ¨åˆå§‹åŒ–çš„æ—¶å€™åˆ›å»ºå¥½subviewï¼Œä¹‹åä½¿ç”¨å±æ€§`hide`æ¥æ§åˆ¶æ˜¾ç¤ºå’Œéšè—ã€‚
6. cellä¸­çš„éœ€è¦åŠ è½½çš„ä¸œè¥¿æ¥è‡ªäºwebï¼Œä½¿ç”¨å¼‚æ­¥åŠ è½½çš„æ–¹å¼ã€‚

å…·ä½“çš„å‚ç…§	
**åœ†è§’ç»˜åˆ¶ï¼š** [iOS - åœ†è§’çš„è®¾è®¡ç­–ç•¥ - åŠç»˜ç”»å‡ºæ²¡æœ‰ç¦»å±æ¸²æŸ“çš„åœ†è§’](http://www.jianshu.com/p/af70feefbc89)  
**å›¾å±‚è°ƒè¯•ï¼š** [è®°-UIæ€§èƒ½è°ƒè¯•åŠè°ƒä¼˜](http://www.jianshu.com/p/3656ef4143da)  
**UITableViewä¼˜åŒ–ï¼š**[UITableViewä¼˜åŒ–æŠ€å·§](http://longxdragon.github.io/2015/05/26/UITableView%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7/)
	
## **UDPå’ŒTCP**
	
TCPå’ŒUDPæ˜¯è®¡ç®—æœºç½‘ç»œä¸­å­¦ä¹ åˆ°çš„æ¦‚å¿µï¼Œå®ƒä»¬ä¸¤è€…éƒ½å±äºè¿è¾“å±‚ã€‚  
	
TCP(Transmission Control Protocol)æ˜¯ä¸€ç§**é¢ç›¸è¿æ¥ï¼Œå¯é çš„æµåè®®**ï¼Œå…¶ä¸­è¿æ¥çš„æ„æ€æŒ‡çš„æ˜¯ä¸¤ä¸ªåº”ç”¨ä¸ºäº†é€šä¿¡ï¼Œåœ¨ä¸¤è€…ä¹‹é—´å»ºç«‹çš„ä¸€ç§è™šæ‹Ÿçš„çº¿è·¯ã€‚å¯é çš„æµåè®®æŒ‡çš„æ˜¯ä¸é—´æ–­æ•°æ®ç»“æ„ï¼Œå°±æ¯”å¦‚ç®¡é“ä¸­çš„æ°´æµï¼ŒTCPæä¾›äº†å¦‚é‡å‘æœºåˆ¶ï¼Œæµé‡æ§åˆ¶ç­‰ä¸€ç³»åˆ—çš„å¯é æ€§ä¿éšœã€‚è™½ç„¶æœ‰TCPæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä¹Ÿæœ‰ä¸è¶³çš„åœ°æ–¹ï¼Œå°±æ˜¯ä¼ è¾“æ•ˆç‡æ¯”è¾ƒä½ã€‚	
	
UDP(User Datagram Protocol)æ˜¯ä¸€ç§**ä¸å…·æœ‰å¯é æ€§çš„æ•°æ®æŠ¥åè®®**ï¼Œåªè´Ÿè´£å‘é€ä¿¡æ¯ï¼Œä½†æ˜¯ä¸ç¡®å®šå¯¹æ–¹æ˜¯å¦æ”¶åˆ°ã€‚ä½†æ˜¯ä¼˜ç‚¹å°±æ˜¯æ•ˆç‡éå¸¸é«˜ã€‚
	
ä½¿ç”¨åœºæ™¯ï¼šåœºæ™¯éƒ½æ˜¯åŸºäºå…¶ä¼˜ç¼ºç‚¹ã€‚ç”±äºTCPä¼ è¾“å¯é æ€§å¾ˆå¼ºï¼Œæ‰€ä»¥åœ¨ä¼ è¾“æ–‡ä»¶ï¼Œæ”¶å‘é‚®ä»¶ç­‰ã€‚UDPæ•ˆç‡é«˜ï¼Œå¯é æ€§æ¯”è¾ƒä½ï¼Œä¸€èˆ¬ç”¨äºç½‘ç»œç”µè¯ï¼Œè§†é¢‘ï¼Œè¯­éŸ³ç­‰ï¼Œå¿…é¡»æ˜¯å®æ—¶çš„ï¼Œå…¶ä¸­å¯èƒ½æœ‰ä¸€ç‚¹ç‚¹æ–­æ–­ç»­ç»­ï¼Œå¯èƒ½å½±å“ä¸ä¼šå¾ˆå¤§ã€‚

## **SDWebImageçš„åŸç†** 

## **ä»€ä¹ˆæ—¶å€™ä¼šé€ æˆå†…å­˜æ³„æ¼**

1. å¯¹äºåœ¨ä½¿ç”¨MRCå†…å­˜ç®¡ç†ç­–ç•¥çš„å¹´ä»£ï¼Œä½ åˆ›å»ºäº†å¯¹è±¡ï¼Œæˆ–è€…`retain`äº†å¯¹è±¡åï¼Œå¹¶æ²¡æœ‰å¯¹å¯¹è±¡åš`release`æ“ä½œï¼Œä¼šé€ æˆå†…å­˜æ³„æ¼		
(ä»¥ä¸‹é’ˆå¯¹åŒ…æ‹¬ARCå’ŒMRCä¸¤ç§å†…å­˜ç®¡ç†ç­–ç•¥)
2. å¯¹è±¡ä¹‹é—´çš„å¾ªç¯å¼•ç”¨
3. å¯¹è±¡å’ŒBlockçš„å¾ªç¯å¼•ç”¨
4. ä½¿ç”¨KVCå’ŒKVOï¼Œå¯¹è±¡æ·»åŠ äº†è§‚å¯Ÿè€…ï¼Œä½†æ˜¯å¯¹è±¡æ²¡æœ‰åœ¨`- dealloc`æ–¹æ³•ä¸­ç§»é™¤è§‚å¯Ÿè€…
5. ä½¿ç”¨é€šçŸ¥çš„æ—¶å€™ï¼Œæ²¡æœ‰ç§»é™¤è§‚å¯Ÿè€… 
6. `performSelector`å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå½“æ‰€æ‰§è¡Œçš„`selector`æœ‰è¿”å›å€¼ï¼Œå¿…é¡»å¯¹è¿”å›å€¼é‡æ–°é‡Šæ”¾ã€‚
7. `NSTimer`ï¼Œå®šæ—¶å™¨ä¼šä¸æ–­çš„ç»™`target`å‘é€æ¶ˆæ¯ï¼Œå³`timer`æŒæœ‰äº†`target`ï¼Œå½“æ²¡æœ‰è°ƒç”¨`[timer invalidate]`ï¼Œ`target`å°±ä¸ä¼šè¢«é‡Šæ”¾æ‰ã€‚é€ æˆå†…å­˜æ³„æ¼ã€‚
8. @try...@catchä¸­ï¼Œå½“æŠ›å‡ºäº†ç§»é™¤ï¼Œç§»é™¤å¯¹è±¡åˆ™ä¸èƒ½è¢«é‡Šæ”¾ã€‚

**æŸäº›ç‚¹å¯ä»¥å‚ç…§**[ARCä¸‹å†…å­˜æ³„éœ²çš„é‚£äº›ç‚¹](https://www.zybuluo.com/MicroCai/note/67734)

## **è‡ªåŠ¨é‡Šæ”¾æ± çš„åŸç†**

åœ¨iOSåº”ç”¨å¼€å§‹çš„mainæ–¹æ³•ä¸­ï¼Œå°±åˆ›å»ºäº†å…¨å±€`autoreleasepool`ï¼Œä¹‹åæ‰€æœ‰çš„å¯¹è±¡éƒ½å­˜åœ¨äºè¯¥è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç çš„å±€éƒ¨åˆ›å»ºå±€éƒ¨çš„`autoreleasepool`ï¼Œä½¿ç”¨`@autoreleasepool{// your code}`

	int main(int argc, char * argv[]) {
	    @autoreleasepool {
	        return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));
	    }
	}

åœ¨æœ€å¼€å§‹çš„ç†è§£ä¸­ï¼Œè®¤ä¸ºå¯¹è±¡çš„é‡Šæ”¾æ˜¯åœ¨`autoreleasepool`çš„å¤§æ‹¬å·({})ç»“æŸçš„æ—¶å€™é‡Šæ”¾äº†å¯¹è±¡ã€‚å…¶å®å¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚åœ¨è‡ªåŠ¨é‡Šæ”¾æ± çœŸæ­£é‡Šæ”¾å¯¹è±¡æ˜¯åœ¨å½“å‰çš„`runloop`è¿­ä»£ç»“æŸçš„æ—¶å€™ï¼Œå®ƒèƒ½å¤ŸçœŸæ­£é‡Šæ”¾çš„åŸå› æ˜¯ç”±äº---**ç³»ç»Ÿåœ¨æ¯ä¸ªrunloopè¿­ä»£ä¸­éƒ½åŠ å…¥äº†è‡ªåŠ¨é‡Šæ”¾æ± Pushå’ŒPop**

### Autorelease åŸç† ï¼ AutoreleasePoolPage

åœ¨ARCä¸­ï¼Œè‡ªå·±å†™ä¸€ä¸ª`@autoreleasepool{}`ä¼šè¢«ç¿»è¯‘æˆ

	void *context = objc_autoreleasePoolPush();
	// {}ä¸­çš„ä»£ç 
	objc_autoreleasePoolPop(context);

![AutoreleasePoolPage](http://upload-images.jianshu.io/upload_images/1626952-db2b2f5ce8d22dd4.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

> * AutoreleasePoolæ²¡æœ‰ç‰¹å®šçš„æ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªAutoreleasePoolPageç»“æ„æ„æˆçš„ï¼Œå®ƒçš„ç»„ç»‡æ–¹å¼æ˜¯åŒå‘é“¾è¡¨ï¼Œä½“ç°åœ¨ç»“æ„ä½“ä¸­çš„æŒ‡é’ˆparentå’ŒæŒ‡é’ˆchildã€‚
> * æ¯ä¸ª`AutoreleasePoolPage`éƒ½æœ‰å¯¹åº”ç‰¹å®šçš„çº¿ç¨‹ï¼Œå…¶ä¸­çš„threadæŒ‡å‘çš„æ˜¯å½“å‰çº¿ç¨‹ã€‚
> * æŒ‡é’ˆ`id *next`æŒ‡å‘çš„æ˜¯å½“å‰`AutoreleasePool`æ–°å¢è¿›æ¥çš„autoreleaseå¯¹è±¡çš„ä¸‹ä¸€ä¸ªä½ç½®ã€‚
> * AutoreleasePoolPageæ¯ä¸ªå¯¹è±¡ä¼šå¼€è¾Ÿ4096å­—èŠ‚å†…å­˜ï¼ˆä¹Ÿå°±æ˜¯è™šæ‹Ÿå†…å­˜ä¸€é¡µçš„å¤§å°ï¼‰ï¼Œé™¤äº†ä¸Šé¢çš„å®ä¾‹å˜é‡æ‰€å ç©ºé—´ï¼Œå‰©ä¸‹çš„ç©ºé—´å…¨éƒ¨ç”¨æ¥å‚¨å­˜`autorelease`å¯¹è±¡çš„åœ°å€ã€‚
> * å½“å½“å‰çš„`AutoreleasePoolPage`ç©ºé—´å¤§å°ä¸è¶³æ—¶ï¼Œå°±ä¼šæ–°åˆ›å»ºä¸€ä¸ª`AutoreleasePoolPage`ã€‚

å‡è®¾å½“å‰çš„çº¿ç¨‹ä¸­åªæœ‰ä¸€ä¸ª`AutoreleasePoolPage`ï¼Œå¹¶ä¸”å·²ç»å¿«å­˜æ»¡äº†`autorelease`å¯¹è±¡ï¼Œå¦‚ä¸‹å›¾:
![å°†è¦å­˜æ»¡çš„AutoreleasePoolPage](http://upload-images.jianshu.io/upload_images/1626952-319e46fcde7ba29b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ä¸Šå›¾çš„`next`æŒ‡é’ˆä¸‹ä¸€ä¸ªä½ç½®å°±æ˜¯æ ˆé¡¶ï¼Œå½“åŠ å…¥ä¸€ä¸ªæ–°çš„`autorelease`å¯¹è±¡æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„`AutoreleasePoolPage`å¹¶ç”¨æŒ‡é’ˆ`child`è¿æ¥æ–°çš„`AutoreleasePoolPage`ï¼Œå®Œæˆè¿æ¥åï¼Œæ–°çš„`AutoreleasePoolPage`nextæŒ‡é’ˆä¼šåˆå§‹åŒ–æ ˆåº•(begin)ä½ç½®ï¼Œæ–°çš„`autorelease`å¯¹è±¡åˆå¯ä»¥æ·»åŠ äº†ï¼ŒğŸ˜„.

### Autorelease åŸç† ï¼ é‡Šæ”¾

å½“è°ƒç”¨`objc_autoreleasePoolPush`æ—¶ï¼Œä¼šå‘`AutoreleasePoolPage`ä¸­æ’å…¥ä¸€ä¸ªå“¨å…µå¯¹è±¡ï¼Œå€¼ä¸º`nil`(0)ï¼Œå¦‚ä¸‹ï¼š

![æ’å…¥å“¨å…µå¯¹è±¡](http://upload-images.jianshu.io/upload_images/1626952-7288fdfe17f32bf6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

å‡½æ•°`objc_autoreleasePoolPush`çš„è¿”å›å€¼æ˜¯å“¨å…µå¯¹è±¡çš„åœ°å€ï¼Œä½œä¸ºå‡½æ•°`objc_autoreleasePoolPop`çš„å…¥å‚ã€‚

æ‰€ä»¥ä¼šæœ‰å¦‚ä¸‹æ“ä½œï¼š

* æ ¹æ®å“¨å…µçš„åœ°å€æŸ¥æ‰¾åˆ°pageçš„åœ°å€
* å¯¹æ™šäºå“¨å…µåŠ å…¥æ‰€æœ‰çš„`autorelease`å¯¹è±¡å‘é€ä¸€ä¸ª`release`é€šçŸ¥ï¼Œå¹¶ä¸”ç§»åŠ¨nextæŒ‡é’ˆåˆ°å“¨å…µå¯¹è±¡ä½ç½®ã€‚
* ç§»é™¤æ‰€æœ‰çš„nextæŒ‡é’ˆä¹‹åçš„`autorelease`å¯¹è±¡ï¼Œå¯ä»¥è·¨å¤šé¡µpage

![è°ƒç”¨pushåæŒ‡é’ˆå¯¹è±¡çš„ç§»åŠ¨å›¾](http://upload-images.jianshu.io/upload_images/1626952-bee2d158b4c4f503.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**æ€»ç»“ï¼šä»¥ä¸Šå³autoreleasepoolçš„åŸºæœ¬åŸç†ï¼Œæ‰€æœ‰å›¾ç‰‡å‡æ¥è‡ªä¸‹æ–¹çš„é“¾æ¥**

[é»‘å¹•èƒŒåçš„Autorelease](http://blog.sunnyxx.com/2014/10/15/behind-autorelease/)  
[Objective-C Autorelease Pool çš„å®ç°åŸç†](http://blog.leichunfeng.com/blog/2015/05/31/objective-c-autorelease-pool-implementation-principle/)

## **nonatomicå’Œatomic**

è¿™æ˜¯ä¿è¯å±æ€§åœ¨è‡ªåŠ¨ç”Ÿæˆ`getter/setter`æ–¹æ³•æ—¶ï¼Œå¯¹`setter`æ–¹æ³•æ˜¯å¦åŠ é”ï¼Œä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚

* atomic : çº¿ç¨‹å®‰å…¨ï¼Œä¼šåœ¨ç”Ÿæˆ`setter`æ–¹æ³•æ—¶å€™åŠ ä¸Šé”ï¼Œç¡®ä¿åœ¨`setter`æ–¹æ³•ç»“æŸå‰åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œå˜é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒthreadAæ­£åœ¨ä¿®æ”¹å˜é‡ï¼ŒthreadBå°±æ— æ³•ä¿®æ”¹å˜é‡ã€‚å¯ä»¥ç¡®ä¿`getter`åˆ°çš„æ•°æ®ä¸€å®šæ˜¯å®Œæ•´çš„ã€‚
* nonatmic : æ²¡æœ‰å¯¹`getter/setter`è¿›è¡ŒåŸå­æ“ä½œï¼Œå¯èƒ½äº§ç”Ÿ`getter`æ–¹æ³•æ²¡æœ‰è·å–åˆ°å®Œæ•´æ•°æ®ã€‚æ¯”å¦‚ï¼Œå½“æ—¶threadAæ­£åœ¨è°ƒç”¨`getter`ï¼Œæ­¤æ—¶threadBæ­£åœ¨ä½¿ç”¨`setter`ï¼Œå‡è®¾å¯¹è±¡çš„æœ‰å‡ ä¸ªå±æ€§ï¼Œå¯èƒ½è·å–çš„å¯¹è±¡å°±åªèƒ½ä¿®æ”¹æˆåŠŸäº†å…¶ä¸­ä¸¤ä¸ªå±æ€§ã€‚

ä¼˜ç¼ºç‚¹ : `atomic`è™½ç„¶ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯æ·»åŠ äº†çº¿ç¨‹é”ï¼Œæ‰€ä»¥æ•ˆç‡æ¯”è¾ƒä½ï¼Œåœ¨å•çº¿ç¨‹ä¸­ï¼Œæ²¡æœ‰å¿…è¦ä½¿ç”¨åŸå­æ€§ã€‚`nonatomic`åˆ™ç›¸åï¼Œæ•ˆç‡æ¯”è¾ƒé«˜ã€‚



 